---
format:
  pdf:
    papersize: a4
    keep-tex: true
    toc: true
    lof: true
    lot: true
    number-sections: true
    link-citations: true
    cite-method: biblatex
    biblatexoptions: style=apa
    include-in-header:  
      - text: |
          \usepackage{graphicx}
          \usepackage{amsfonts}
          \usepackage{amsmath}
          \usepackage{setspace}
          \usepackage{pifont}
          \usepackage{booktabs}
          \usepackage{dcolumn}
          \usepackage{makecell}
          \usepackage{threeparttable}
    include-before-body: 
      - file: "./title_page.tex"
bibliography: "./Master Thesis.bib"
---

# Introduction

The rainforests of the Amazon are under severe pressure from deforestation. In the two centuries leading up to 2022, 8.6% of primary forests in Brazil were cleared [@worldresourcesinstituteGlobalForestWatch2023]. The importance of these areas is manifold. Their extreme levels of biodiversity have high intrinsic value to the world's ecosystem  [@maslinNewViewsOld2005; @laurila-pantHowValueBiodiversity2015] and local communities [@omettoAmazonDeforestationBrazil2011]. Land use change in primary forests releases large amounts of greenhouse gases, which in turn have negative impacts on a global scale [@malhiClimateChangeDeforestation2008; @harrisGlobalMapsTwentyfirst2021]. As a carbon sink, rainforests bind greenhouse gas, working against climate change [@harrisGlobalMapsTwentyfirst2021]. Logging has lead to an estimated emission of around 36 gigatonnes of CO2-equivalent greenhouse gas emissions from 2001 to 2022 in Brazil alone [@worldresourcesinstituteGlobalForestWatch2023]. 

Economists model deforestation decisions as a tradeoff between its cost and benefits. On can observe that cleared land is reused for agriculture, livestock or mining [@baronaRolePastureSoybean2010; @sonterMiningDrivesExtensive2017]. These endeavors of alternative use are profitable for their owner but also occur costs reaching beyond the limits of the given areas. Based on the discussed negative impacts on climate change alone, researchers conclude that the social costs through climate change would, if considered by the market, render all agricultural conversion in the Amazon inefficient [@souza-rodriguesDeforestationAmazonUnified2019].

In addition to the global reaching effects of deforestation on the climate, there is a substantial body of literature discussing its impact on local utility in the form of health outcomes. Empirical evidence from medical and geoscientific research find negative effects of deforestation-related wildfires and on malaria prevalence [see for example @reddingtonAirQualityHuman2015; @tuckerlimaDoesDeforestationPromote2017]. Given the existing evidence it appears likely that these dangers to the local communities are not considered to the extent it would be socially desireable [@balboniEconomicsTropicalDeforestation2023].

Previous work has shown the important role of forests in preventing soil erosion [see for example @wilkinsonPresentSoilErosion1994; @veldkampDeforestationReforestationImpacts2020]. Absent this, one would expect increased river pollution downstream of areas subject to logging. Agricultural land use of cleared land may further increase this effect through livestock-related ground pollution [@montgomerySoilErosionAgricultural2007]. In this thesis I seek to shed a light on the importance of rivers in propagating pollution of deforestation on a vast geographical scale. In other words, I want to find evidence of the role of rivers on health outcomes when there occurs deforestation upstream. I seek to test the hypothesis that 

1. Deforestation leads to river pollution, and that 
2. Deforestation impacts health through the river system.

I attempt to test these hypotheses with a novel combination of vast public data. I aggregate deforestation around rivers and observe changes in health outcomes down the course of the river. To this end I compute a detailed model of all Brazilian rivers and their corresponding drainage areas. Using sensor-measured information on river pollution I estimate the correlation between river contamination and upstream land use. To test my second hypothesis, I assemble a data set of deforestation and health outcomes in all Brazilian municipalities between 1995 and 2022. Using an instrumental variables approach I aim to isolate the causal relationship between the decline of forests and mortality, hospitalization, and health care expenditure. Potentially exogenous variation in cloud cover serves as my instrument. Because monitoring and enforcement of illegal logging is based on satellite technology, cloud cover restricts or even prohibits effective law enforcement, leading to increased deforestation.

My empirical analysis does not find a clear and significant connection between forest removal, pollution and health outcomes. On aggregate there is some evidence that upstream deforestation is associated with increased pH and total residue in river water. Mining is shown to have the strongest correlation, mostly on water turbidity and biochemical oxygen demand. The picture is however ambiguous: Unexpectedly I also find decreased biochemical oxygen demand in areas with increased upstream deforestation. Turbidity levels are on average lower when agriculture replaces forests. There is also no conclusive evidence that nitrogen and nitrate levels are altered by farming activity.

The instrumental variable regression focusing on health outcomes also yields only inconclusive results. I do not find statistically significant effects on mortality, infant mortality and health care expenditure. There is however evidence for an impact on hospitalization. I find that a decrease of forest area upstream of 10 percentage points is associated with an increase of around 2.5 standard deviations in hospitalizations. This result holds when modeling spatial autocorrelation in the error term in a spatial error model. The results are however sensitive to parameter choices and do not hold in OLS and when altering the temporal or spatial scope. I therefore refrain from attaching any causal interpretation to my findings and conclude that my approach cannot confirm health impacts of deforestation.

The impact of deforestation on health outcomes has been subject of several publications [@ellwangerDiversityLossClimate2020; @reddingtonAirQualityHuman2015]. The costs of soil erosion were also discussed in a broad range of literature [see for example @tellesCostsSoilErosion2011]. @balboniEconomicsTropicalDeforestation2023 provide an excellent review on the economics of deforestation. Soil erosion as a driver of pollution and pollution-induced health costs has to the best of knowledge only been covered in a small-scale fashion by @maHumanHealthRisk2014 and therefore remains a gap in the research. 

The remainder of my thesis is structured as follows. In a literature review, I first introduce theoretical evidence on the mechanism of impact surveyed. Following that I introduce my model and provide evidence for my approach toward statistical identification. In the fourth section of this thesis I elaborate on the data used. After that I present the results of my empirical analysis and then conclude with a brief discussion.

# Literature Review

## Economic Models of Deforestation

Driven by short-run benefits of lumber or alternative land use, researchers observe unprecedented levels of rainforest degradation in the Anthropocene [@malhiClimateChangeDeforestation2008]. This is of elevated importance as any loss of primary forests cannot be undone in any reasonable temporal scope [@shuklaAmazonDeforestationClimate1990; @balboniEconomicsTropicalDeforestation2023]. The scientific evidence for the negative impacts of deforestation raises the concern that these externalities are not internalized by the forest extraction market and that deforestation does not occur at a socially optimal rate. At the core of this thought lies the (monetary) assessment of the societal cost of deforestation against the economical gains from alternative use and timber. 

Many economic models have been developed to weigh these benefits and external costs on a local and global scale. In their analysis, @balboniEconomicsTropicalDeforestation2023 describe several such models of decision making for deforestation. Their benchmark model, which they claim to closest resemble the microeconomic process of decisionmaking today, disregards externalities but instead focuses on short-run benefits. In fact, discounting of future income leads to a situation where this benchmark model does not guarantee extraction rates that are at or below a *maximum sustained yield* of forest regrowth. They note that lack of property rights and regulation further increases discounting rates in regions like Brazil.

Extended models then acknowledge the fact that deforestation is associated with social costs that are not internal to the parties with property rights to the forest [@balboniAppendixEconomicsTropical2023]. By modeling this cost as a fixed shift to the private marginal cost, the socially optimal equilibrium lies below the market-achieved private rate. This underlines the necessity to internalize these costs through policy. Economic theory yields several instruments to achieve this goal. Pigouvian taxes on logging or subsidies for landowner to *not* remove a forest are among the popular [@balboniEconomicsTropicalDeforestation2023]. I discuss several such attempts in @sec-policy. It does however remain essential to know the extent of the social costs of deforestation for any such policy to work. My proposed paper therefore has important policy implications by shedding a light on the superlocal health cost of logging across Brazil.

## Health Externalities of Deforestation {#sec-health_effects}

The body of research on impacts of deforestation on human health is manifold. There exists convincing evidence that fires used to clear forests lead to increased air pollution and levels of mortality due to pulmonary diseases [@reddingtonAirQualityHuman2015]. While the latter form of pollution may have lingering effects on health, this mechanism of impact of inherently tied to the moment of first clearing a forest. Other studies focus on latent forms of damage arising from the altered landscape after deforestation. It turns out that several species of mosquito connected to spreading Malaria thrive in the cleared areas with more open land and artificial water infrastructure [for example see @olsonDeforestationMalariaMancio2010]. There is however significant debate if this is in fact the driving mechanisms for some of the observed correlations. Increased human exposure to mosquito habitat, increased immunity and biased data on health outcomes may serve as alternative explanations [@tuckerlimaDoesDeforestationPromote2017]. 

Research has revealed how soil after deforestation features significantly altered biological properties, reducing its ability to retain nutrient storage essential for agriculture and deteriorating its function as greenhouse gas storage [@veldkampDeforestationReforestationImpacts2020]. Important for the context of this study, reduced erosion resistance is another key finding of many studies [for example see @molinaComplexLandCover2012; @zhengEffectsErosionPatterns2005; and @restrepoa.ImpactoDeforestacionErosion2015]. @veldkampDeforestationReforestationImpacts2020 review how the change in soil properties resulting from deforestation and alternative use decrease the ability of soil to allow vertical water flow, increasing the likelihood of erosion through overland flow. This effect is mediated by the type of soil, the slope of the landscape and the kind of replacing alternative use [@pimentelEnvironmentalEconomicCosts1995]. Ecological accounts of the impact of this process range from negligible [@neillWatershedResponsesAmazon2013] to devastating [@giertzAssessingEffectsLand2005]. @hohnerWildfiresAlterForest2019 describe how wildfires used for deforestation may further amplify erosion. 

This now allows me to sketch a clear story of the mechanism I want to survey following the framework of *contamination*, *exposure* and *dose-response* [for example see @graffzivinEnvironmentHealthHuman2013]. Deforestation (the independent variable of the study) impacts soil erosion, leading to river pollution (*contamination*). This water may then be used by the local population (*exposure*), leading to negative health outcomes (*dose-response*). Future statistical analysis may include the discussed mediating factors as controls or interaction terms. This model also allows me to potentially estimate a range of models for every stage of the framework if data is available.

While most research focuses on the on-site productivity losses caused by soil degradation, there is existing evidence on how increased erosion impacts sediment runoff and water pollution off-site. @maHumanHealthRisk2014 describe how deforestation increased toxic contamination in a Chinese region subject to deforestation-induced erosion but only indirectly estimate impacts on health outcomes. Most economic estimations of the externalities are tied to estimating defensive expenditures in water pollution. As early as 1988, @holmesOffsiteImpactSoil1988 finds that this increase in erosion leads to increased defensive water treatment cost. In a more recent study @vincentValuingWaterPurification2016 estimate that forest cover decreases water treatment expenditure in Malaysia.

Extending the context to a more wholistic view on social costs in general, in addition to the health outcomes outlined above, the social costs of soil erosion include dam silation and flooding. @clarkErodingSoilsOfffarm1985 calculated the social cost of offsite erosion at USD 3 billion to USD 13 billion in 1980 and the United States alone. @pataultAnalysisOffsiteEconomic2021 estimate the offsite cost of erosion for two sites in Northern France and find costs in the range of EUR 1,000 to EUR 4,300 per year and kilometer squared. 

## Policy Instruments on Deforestation {#sec-policy}

From an ecological point of view, @malhiClimateChangeDeforestation2008 outline their much-cited recommendation on policy agendas managing deforestation in the Amazon: To avoid reaching catastrophic tipping points, a gross maximum deforestation rate of 30%-40% with limited fragmentation should be targeted. They suggest migration corridors, river conservation and the protection of a core rainforest to the end of preserving biodiversity. Finally, education initiatives should target a reduction in wildfires.

Historically, government development policy in Brazil has been a major driver of deforestation, enabling access through large-scale infrastructure projects and subsidies on lifestock and mining endeavors [@maharGovernmentPoliciesDeforestation1989]. Since 1965, the Forest Code regulates land use in the Amazon [@soares-filhoCrackingBrazilForest2014]. While changes in the 1990s have increased its focus on conservation, conflicting interest of the agricultural sector have limited its requirements and kept compliance low. 

Brazil has since made extensive pledges to reduce deforestation-related emissions and implements a range of policy and monitoring instruments to ensure attainment [@tacconiLawEnforcementDeforestation2019]. Since its inception in 2008, the Amazon Fund is important cornerstone policy in Brazil's strategy against deforestation [@correaAmazonFund102019]. It is at its core an implementation of the principles of the Reducing Emissions from Deforestation and Forest Degradation (REDD+) framework. International donations are used to fund conservation projects in monitoring existing regulation, maintaining protected areas, supporting sustainable production and investments in innovations. The central idea is to make payments conditional on environmental efforts and thereby subsidize abatement for those who would not have been able to afford it void the transfers [@balboniEconomicsTropicalDeforestation2023]. The effectiveness and efficiency of this command-and-control approach is however disputed [@correaAmazonFund102019]. *Bolsa Verde*, another example of a REDD+ program, paying poor landowners in the Amazon to maintain forest cover is considered to be cost effective [@RePEc:cgs:wpaper:110].

The Detection of Deforestation in Real Time (DETER) system and Action Plan for the Prevention and Control of Deforestation in the Legal Amazon (PPCDAm) of 2004 have been shown to have significantly reduced deforestation through monitoring and enforcement efforts [@nepstadSlowingAmazonDeforestation2014; @internationalpartnershiponmitigationandmrvImplementingPreventionControl2018]. The DETER system provides the central identification strategy of my analysis: When anti-deforestation efforts are dependent on the ability to observe land cover changes with satellites, cloud coverage prohibits effective response.

# Methodology

This thesis is approaches the issue of deforestation, river pollution and health outcomes in 2 stages. First, using water quality sensor data, I estimate if deforestation impacts water quality. Using the insights from this analysis, I then attempt to estimate the impact of deforestation on a range of health outcomes using an IV strategy. In this section I outline my model details and identification strategies.

## Sensor-measured river pollution

As discussed above, biochemical, theoretical research suggests that deforestation may facilitate ground erosion. Rainfall may then cause pollutants to be drained into the river system, resulting in pollution. Using a large, unbalanced panel of sensor data, I estimate the correlation between river pollution and deforestation. For each sensor, I identify all upstream rivers and calculate distances from each river segment to the sensor. I estimate panel regression models with sensor- and year-fixed effects:
$$
\text{Pollution}_{it} = \alpha + \beta \cdot \text{Deforestation}_{it} + \gamma_i + \delta_t + \epsilon_{it}
$$

where $\text{Pollution}_{it}$ is the pollution level measured by sensor $i$ in year $t$, $\text{Deforestation}_{it}$ is the measure of deforestation upstream of sensor $i$ in year $t$, $\gamma_i$ represents the sensor-fixed effects, accounting for time-invariant characteristics of each sensor, $\delta_t$ represents the year-fixed effects, accounting for shocks common to all sensors in a given year, and $\epsilon_{it}$ is the error term, which is clustered at the estuary and year level to adjust for within-estuary and -year correlation.

The detail of my data allows me to also investigate how different forms of alternative land use impact river pollution. I estimate an analogous model to the above, regressing sensor measurements on four superclasses of land cover replacement: pasture, agriculture, urban environments and mining. Finally, I investigate how distance interacts with the estimated effects. To this end, I aggregate the data into consecutive distance bins of 50km from the sensor and run a panel fixed effects regression with the following model:

$$
\text{Pollution}_{itj} = \alpha + \beta \cdot \text{Deforestation}_{itj} + \theta \cdot (\text{Deforestation}_{itj} \cdot \text{Distance}_{itj}) + \gamma_i + \delta_t + \epsilon_{it}
$$

## Health Outcomes

Given the above mechanisms of pollution, if the contaminated water comes into contact with the local population, negative health outcomes are to be expected. Using municipality-level mortality rates, data on hospitalizations and -spending, I attempt to estimate the relationship between deforestation and health. To this end, I regress the respective health indicator on both spatially and temporally cumulative upstream deforestation. The temporal cumulativeness results in an interpretation of the data as *deforestation since 1985*, the first year on record. Spatial cumulation is performed using a spatial weighting matrix closer described in @sec-appendix-hydro. Deforestation in my model is the weighted mean of deforestation in all upstream municipalities with weights decreasing in distance. I include municipality and annual fixed effects and report two-way clustered standard errors.

A key issue in this analysis is the potential endogeneity between deforestation and health outcomes. Endogeneity can arise if there are omitted variables that simultaneously affect both deforestation and health, leading to biased estimates. For example, economic development might influence both the rate of deforestation and healthcare quality, creating a spurious correlation. Additionally, reverse causality could be a concern if poorer health outcomes drive changes in land use, such as increased deforestation to make way for agricultural expansion aimed at improving local food security.

To address these endogeneity concerns, I utilize an instrumental variable (IV) approach. An appropriate instrument is one that is correlated with deforestation but uncorrelated with the error term in the health outcome equation. Since mid-2004 the Detection of Deforestation in Real Time (DETER) system monitors land use changes in the legal Amazon. Satellite imagery is used in an automated system to inform the authorities of deforestation events. Until 2017, daily, 250m-resolution imagery of the Moderate-resolution Imaging Spectroradiometer (MODIS) was used for this analysis. This allowed for the detection of deforestation of areas larger than 25 hectares [@dinizDETERBNewAmazon2015]. Crucially, satellite-based surveillance is impossible if lasting cloud coverage prohibits the view from the sky. 

This gives rise to my identification strategy: Following an approach similar to @assuncaoDETERingDeforestationAmazon2023, I use data on cloud cover as an instrument for deforestation. The central rationale behind this approach is that high levels of cloud cover at a given forest site prohibit remote sensing and thereby also effective enforcement of anti-deforestation regulation. This may impact deforestation but is likely exogenous to public health outcomes downstream. The validity of this IV approach hinges on the instrument satisfying both relevance and exogeneity conditions. I test the relevance by checking the strength of the correlation between the instrument and deforestation, reporting first-stage F-tests for all model specifications. 

Exogeneity requires the instrument to neither directly (*exogeneity*) nor indirectly influence health outcomes through any other variable than deforestation (*exclusion restriction*). The most obvious concern is that increased cloud coverage comes in hand with weather conditions that have effects on public health. For example, increased rainfall may lead to a rise in waterborne diseases or vector-borne diseases like malaria and dengue fever, which are sensitive to changes in precipitation. The spatially cumulative nature of my outcome variable helps alleviate this concern. Since the independent variable of interest is upstream deforestation, I aggregate deforestation in an area of up to 1000 kilometers in river length. The larger the distance, the less likely weather is going to impact health outcomes at a given municipality. Nevertheless, I do include weather controls, namely average precipitation and temperature in my models.

In addition to these theoretical arguments, I provide a placebo test for the validity of the instrument in @tbl-reg-placebo. Using an alternative data source on cloud cover, I test whether the latter predicts deforestation before DETER was initiated and in areas outside the legal Amazon where it is active. Since DETER only reports cloud cover for the areas and the duration in which it is active, I obtain data on cloud cover from ESA and aggregate them by municipality as discussed above. Importantly, both cloud cover indicators are constructed differently: While DETER reports the share of the municipality in which no observation was possible within a year, ESA utilized the higher spatial detail of their satellite data to calculate the overall share of cloud cover within the municipality and year. To show that both are approximately equivalent, I first regress the DETER on the ESA data and find that the former is explained well by the latter. This allows me to estimate the placebo test using the ESA in stead of the DETER data. In the second column I test whether cloud cover predicts deforestation rates in- and outside the legal Amazon before DETER was active. Encouragingly, none of the coefficients are statistically significant. After 2005, when DETER was initiated, cloud cover only predicts deforestation in the legal Amazon. This finding is statistically significant at all conventional levels. The instrument therefore passes my placebo test.

{{< include /tables/reg_placebo.tex >}}

Finally, a concern is that cloud coverage may be reversely caused by deforestation. Over the past few decades, numerical simulations predict a decrease in cloud cover in some parts of the Amazon, particularly in regions experiencing extensive deforestation [@royMesoscaleVegetationAtmosphere2009]. This analysis is based on the theoretical finding that deforestation disrupts local hydrological cycles, reducing evapotranspiration and subsequent cloud formation [@lejeuneInfluenceAmazonianDeforestation2015]. On the contrary, empirical evidence from the Brazilian rainforest contradicts this, showing that deforestation is associated with increases in forest cover [@royMesoscaleVegetationAtmosphere2009, @xuContrastingImpactsForests2022]. In any case, there appears to be a theoretical and empirical link between cloud cover and deforestation. I am not able to rule out this reverse causality between the instrument and the endogenous regressor. In comparison to @assuncaoDETERingDeforestationAmazon2023, this is a more elevated issue in my work because I use cloud cover to directly instrument deforestation opposed to law enforcement activity. Any further findings should therefore be read keeping this in mind.

My main analysis then follows the following model structure. I attempt to estimate the causal relationship between deforestation and health outcomes with a two-stage least squares (TSLS) approach. In the first stage I regress the potentially endogenous regressor of deforestation on the instrument, cloud coverage, and any control variables. Any variation in deforestation remaining after recovering the fitted values from this model should then be exogenous i.r.t. the main relationship in my model. The first stage formula is given by the equation:

$$ 
\text{Deforestation}_{it} = \alpha_0 + \alpha_1 \text{CloudCoverage}_{it} + \mathbf{X}_{it}\mathbf{\beta} + \lambda_i + \gamma_t + \epsilon_{it}
$$

where $\text{Deforestation}_{it}$ is the deforestation in municipality $i$ at time $t$, $\text{CloudCoverage}_{it}$ is the instrument for deforestation, $\mathbf{X}_{it}$ is a vector of control variables, $\lambda_i$ represents the municipality fixed effects, $\gamma_t$ represents the time fixed effects, and $\epsilon_{it}$ is the error term.

In the second stage, I then use the fitted values of deforestation from the first stage as an instrument in the following regression:

$$ 
\text{HealthOutcome}_{it} = \beta_0 + \beta_1 \widehat{\text{Deforestation}}_{it} + \mathbf{X}_{it}\mathbf{\delta} + \lambda_i + \gamma_t + \nu_{it}
$$

where $\text{HealthOutcome}_{it}$ represents the health indicators such as mortality rates, hospitalizations, or healthcare spending in municipality $i$ at time $t$, $\widehat{\text{Deforestation}}_{it}$ are the predicted values of deforestation obtained from the first stage, $\mathbf{X}_{it}$ includes the control variables, $\lambda_i$ and $\gamma_t$ are the fixed effects, and $\nu_{it}$ is the error term.

To ensure robust inference in the presence of potential correlation in the error terms across both municipalities and years, I utilize the two-way clustered standard error correction method proposed by @cameronRobustInferenceMultiway2011 as implemented by @gaure2013lfe. This method adjusts standard errors to account for clustering along both dimensions. To be specific and following the idea of @assuncaoDETERingDeforestationAmazon2023, I choose to calculate cluster-robust standard errors robust to unobserved variation within a municipality over time and between municipalities of a given immediate region in a year.^[Immediate regions (*Regiões geográficas Imediatas*) are an official assignment of all	5570 Brazilian municipalities into 510 groups. Municipalities within a group border each other and are likely to experience the same shocks i.r.t. health outcomes.] This is crucial given the potential for spatial spillovers and temporal autocorrelation in environmental and health data. For example, unobserved shocks affecting health outcomes could be correlated within a municipality over time or across municipalities in a region due to local policies or environmental factors. By employing this correction, I mitigate the risk of underestimating the true variability of the estimated coefficients, which would otherwise lead to overly optimistic inference (i.e., lower p-values and narrower confidence intervals). 

Given the spatial nature of my panel, there is a concern that spatial autocorrelation in the independent variables between municipalities may lead to biased or inefficient estimates in the regression models. Nearby municipalities cloud be subject to common shocks and may share characteristics. This violates the assumption of independence required for OLS analysis. If there is spatial dependency, standard errors are likely to be underestimated, leading to an overstatement of the significance of the predictors. As an extension to my main approach, following @salima2018spatial, I address this issue with a spatial error model as implemented in R by @millo2012splm. This entails obtaining within variation by demeaning and then iteratively obtained a maximum likelihood result for the model parameters. Feasible generalized least squares estimation yields estimates for $\beta$, model residuals, and the error variance $\sigma^2_{\epsilon}$. Using these best guesses, the model log-likelihood is maximized, yielding the spatial autoregressive parameter $\hat{\rho}$. The process is initiated with  $\hat{\rho}$ from OLS. This two-step (fGLS followed my ML) approach is repeated until convergence of the parameters. If spatial autocorrelation is present in the data, this method provides more accurate and reliable estimates.^[Please refer to @millo2012splm [p. 12] for details on likelihood functions.]

# Data

For my research I source and combine a selection of public data from the realms of environmental science, health and economics. In @fig-data-workflow I present the entire workflow of the project to give an orientation of the different scripts and data sources used. Not all data is available in all time periods. In @fig-variable-temporal-ranges I present the availability of variables across time. For my central analyis of deforestation and health outcomes, I subset data for which a complete panel without missing values is available. The municipalities included in these panels are shown in @fig-balanced-panels.

## Deforestation data

In the field of land use classification there have been made several recent advancements allowing for detailed and thorough analyses of changes of land cover. For Brazil specifically, the MapBiomas project [@souzaReconstructingThreeDecades2020] provides detailed, annual land cover classification at 30m resolution. I obtain *Collection 8* rasters and aggregate the data by drainage polygon and year. To this end, I simplify the data's classification and re-group them into the categories of forest, pasture, agriculture, urban, and mining.^[See @tbl-mapbiomas-equivalence for a correspondence table between MapBiomas and my classes.] Finally, I count deforestation events as pixel-wise changes between two subsequent years from forest to any other class. 

In 1986, I classify about 68.5% of area in Brazil as forests. By 2020, this had reduced by 9.9 percentage points to 58.6%. In the legal Amazon, forest cover went from 84.5% to 72.6%. During that time and in the legal Amazon, area used for pasture strongly increases from 4.5% to 14.5%. Agricultural usage increases from 0.7% to 4% and cities make up about about 1.2% of area at the end of the timeframe. Mining is performed on 0.05% of area, an increase of 600% over the value in 1986.

## Health Indicators

In my analysis I observe health outcomes from two major data sources: I obtain death records from @ministeriodasaudedobrasilmsSistemaInformacoesMortalidade2022. Upon the passing of every Brazilian, medical professionals are required to fill out a standardized form that is collected by the responsible government agency. Each record states the age and home municipality of the diseased. Aggregating by municipality and combining it with birth and population estimates from @ministeriodasaudedobrasilmsNascidosVivosSINASC2023 and @ibgePopulacaoBrasileira2022 respectively allows me to calculate mortality rates. 

In addition to that I use aggregated inpatient and spending data from @ministeriodasaudedobrasilmsSistemaInformacoesHospitalares2024 to observe spending and patient numbers. The *Sistema Único de Saúde* is the public provider of healthcare in Brazil that finances close to all medical services in the country. The resulting patient data is therefore highly representative of hospital loads and allows for an comprehensive account of healthcare costs.

## Cloud Cover

The DETER project [@dinizDETERBNewAmazon2015] publishes monthly cloud polygons in which they were not able to observe land cover changes. With some sporadic gaps, this data is mostly complete from mid-2005 until 2017. I rasterize and aggregate the data by municipality and year. To allow for analyses before 2005 and outside the project's boundaries (the legal Amazon), I also access CLARA-A3, a sensor-based long-term collection of cloud cover data by @copernicusclimatechangeserviceCloudPropertiesGlobal2022. It is important to note that the definition of cloud cover in both sources differs significantly. While CLARA report average monthly cloud cover in a given cell throughout the month, DETER reports areas in which they were not able to make any observations within the same time frame. Also, while both sensors provide great temporal detail of two or one daily observation respectively, the exact times of observation and spatial resolution (1.1km and 250m) differ between the two [@noaanationalcentersforenvironmentalinformationAdvancedVeryHigh1978; @nasaMODISSpecifications2024]. In @fig-stations I provide example images of cloud cover for both sources and show that the resulting municipal indicators are correlated.

## River and drainage model

In order to trace potential outcomes down the flow of rivers, I compute a detailed model of all rivers in Brazil. Based on @agencianacionaldeaguasesaneamentobasicoanaSistemaNacionalInformacoes2017 and using tools of network analysis, I identify 1025 sub-networks identified by their shared estuary into the ocean, 123,140 confluences between rivers, and 125,192 source points. For every river segment I calculate its distance for the estuary to the sea. For further processing I split rivers at municipality borders to make both bijectively relatable. This network model is then used to calculate upstream reachability information for every node, which I aggregate by municipality. In @fig-river-network-model I provide an example of the detail of this data.

My research design also requires me to link deforestation to rivers. Any sediments rivers would follow the flow of water through the terrain. Starting from drainage trenches, the flow of water accumulates until the stream can be considered a river. Surrounding any river there is therefore a watershed area which feeds into it. To model this, I split rivers into segments of 1km and then use the methodology of @bartos_2020 with the digital elevation model provided by @europeanspaceagencyCopernicus2022 to calculate exact drainage polygons around the river segments. This approach requires extensive data pre-processing and matching algorithms which I further elaborate on in @sec-appendix-hydro. These polygons are then used to extract deforestation as discussed above. In @#fig-drainage-extraction I present an example of the detailed results of this process.

## Sensor data

The Brazilian National Water Agency (ANA) collects standardized information on water quality in the @agencianacionaldeaguasanaPortalQualidadeAguas2024. I download all available historical data from the HidroWeb system of the National Water Resources Information System (SNIRH) and aggregate them by year, resulting in an unbalanced panel of 4,522 stations in 45,094 data points. In my analysis I focus on the variables of pH, turbidity, biochemical oxygen demand (BOD5.20), dissolved oxygen, total residue, total nitrogen, and nitrate concentration. Not all variables are measured at all times, please refer to @tbl-summary-sensor-data for summary statistics. Maps of the spatial distribution of all stations across time intervals are provided in @fig-stations. Before the year 2000 only few stations mostly situated in the urban South-West report measuruments. Therefore I choose to drop earlier observations and focus on the later years with more complete coverage.

{{< include /tables/summary_sensor_data.tex >}}

## Control variables

To account for potential confounding factors, several control variables are included in the analysis. These controls are GDP per capita, average schooling grades, a vaccination index, primary care coverage, doctors per capita, urbanization and the availability of sewage systems. Data for GDP per capita are sourced from @ibgeProdutoInternoBruto1996. Average schooling grades in form of the IDEB index are sourced @institutonacionaldeestudosepesquisaseducacionaisinepIndiceDesenvolvimentoEducacao2005. The vaccination index, representing the coverage of essential immunizations, is derived from health department records @ministeriodasaudemsSistemaImunizacoes1994.^[I focus on the number of administered vaccinations against yellow fever, hepatitis A and B, polio, and Haemophilus influenzae type B. In the analysis I use a rolling 5-year average of annual vaccination rates of newborns.] I obtain the coverage with primary care and the number of doctors per capita from @ministeriodasaudemsCoberturaAtencaoBasica2007. Finally, data on urbanization and sewage availability are obtained from municipal health and infrastructure reports @ministeriododesenvolvimentoregionalmdrSistemaNacionalInformacoes1995. Data on migration and race are obtained from @ibgeCensoDemografico2000, the waves of 2000 and 2010. To be specific, I utilize question V0417 (*NASCEU NESTE MUNICÍPIO?*, V0618 in 2010) to identify migrants and item V0408 (V0606 in 2010) to identify race. Census sample weights are applied during aggregation by municipality.

# Empirical Results

## Sensor-measured river pollution

If deforestation was to expose populations to health outcomes along rivers, one should be able to estimate an impact on sensor-measured river pollution. Evidence from environmental science shows that soil erosion increases turbidity by introducing sediments into water bodies, reducing light penetration and affecting aquatic life [@u.s.epaTurbidityParameterFactsheet2021]. Eroded soils carry organic matter and nutrients, raising biochemical oxygen demand levels and potentially depleting dissolved oxygen, crucial for aquatic organisms [@u.s.epaDissolvedOxygenParameter2021]. The increased runoff also contributes to higher total residues, nitrogen, and nitrate concentrations, leading to harmful algal blooms [@u.s.epaNutrientsParameterFactsheet2021]. Altered pH levels can further disrupt the ecological balance and water quality [@u.s.epaPHParameterFactsheet2021].

In @tbl-reg-deforestation-sensors I present regression results for the corellation between aggregate upstream deforestation and pollution.^[See @tbl-reg-deforestation-sensors-sd for standardized coefficients.] I find that deforestation of ten percent of upstream area is associated with a increase in the water's pH level by 0.12 or 0.16 standard deviations, an increase in total residue by 11.55 or 0.4 standard deviations and a decrease of biochemical oxygen demand by 1.86 or 0.3 standard deviations c.p.. These coefficients are statistically significant at the 5%, 10% and 5% level respectively. The increases in total residue and pH match expectations while the decrease in biochemical oxygen demand is surprising. Coefficients for turbidity and dissolved oxygen are negative but statistically insignificant. Nitrate and total nitrogen readings are on average insignificantly increased.

{{< include /tables/reg_stations_deforestation.tex >}}

To further shed a light on the mechanism of impact behind this correlation I now turn to the effect of the different replacing land cover types. For any deforestation event, I identify what forests were replaced by and group this into four categories: Pasture, agriculture, urban environments, and mining. In @tbl-reg-deforestation-sensors-replacement I present OLS results of this analysis, with otherwise equivalent model parameters to the above. I find that deforestation for pasture is associated with increased turbidity and BOD5.20 measurements. Observed pH, dissolved oxygen, total residue, total nitrogen and nitrate levels are decreased but the coefficients are not statistically significant. In contrast to that, increased agricultural area is correlated with decreased turbidity and otherwise similar insignificant coefficients. When urban areas replace forests, I observe an on average reduced level of BOD5.20. Coefficients for pH, total residue, nitrogen and nitrates are positive but not statistically different from zero. In cases where mining displaces forests I find strong increases in turbidity and BOD5.20. Readings of dissolved oxygen are on average lower. Estimates for total residue, nitrogen and nitrates are positive but high variation does not allow for confidence in the latter estimates. 

{{< include /tables/reg_stations_deforestation_replacement.tex >}}

In @tbl-reg-deforestation-sensors-replacement-levels I present results when regressing on levels of land cover instead of deforestation events. This model is more intuitive to interpret as I am pivoting away from only looking at year-to-year changes in land cover and sensor measurements to also considering the *stock* of land cover present upstream of a sensor. However, this approach is likely to suffer from spurious variation. The decreasing trend in cumulative forest cover (and the increasing trends in other land cover categories) might coincide with trends in unobservables, yielding biased coefficients. Overall, this analysis yields similar results. In contrast to my main findings, coefficients for pH on pasture and agriculture are positive. High agriculture levels are associated with high instead of lower levels of turbidity. The negative coefficients for the relationship between pasture, agriculture, and dissolved oxygen as well as total residue are now statistically significant. Nitrate coefficients for pasture, agriculture and urban land cover are now significant. Finally, the relationships between mining and turbidity, BOD5.20, and dissolved oxygen are not statistically significant any more. 

Finally, in @tbl-reg-deforestation-sensors-distance I observe how the effect of deforestation differs with the distance to the deforestation. To this end I regress the pollution indicators on deforestation and its interaction with the distance bin it is measured upstream from the station. All effects with the exception of turbidity decrease in distance although point estimates for the interaction term are significant only for dissolved oxygen and total residue.

In conclusion, I find several theoretical results validated. Deforestation is associated with altered pH and total residue in the water. Unexpectedly, biochemical oxygen demand is on average lower when there is upstream deforestation. It turns out that mining is most strongly correlated with sensor readings. I find increased turbidity, BOD5.20 and decreased dissolved oxygen in water downstream of mines. Surprinsingly, I do not find increased nitrogen and nitrate readings when there is increased upstream farming activity. However, turbidity and BOD5.20 levels are increased when pasture areas are created. Many other idiosyncratic factors influence the discussed relationship. While the fixed effects approach alleviates some concern, I want to stress that I do not claim any of these results to be causal relationships. 

## Health Outcomes {#sec-results-health}

The theoretical and parts of the empirical evidence presented thus far suggest that deforestation leads to river pollution. If humans then get into contact with the contaminated water, there may be consequences for their health. In this chapter I seek to obtain causal evidence for this relationship. To this end I estimate the impact of aggregate upstream deforestation on a range of health indicators using an instrumental variable approach: As discussed in more detail above, cloud cover restricts efficient enforcement of deforestation restrictions. Areas with increased cloud cover are therefore subject to more deforestation. This variation in cloud cover is likely to be exogenous in regards to health outcomes and therefore a suitable instrument. 

Before I turn to the results of the analysis, I present first stage results. In @tbl-reg-deter-first-stage I regress upstream DETER cloud cover on upstream deforestation for all municipalities. I present three different specifications, each consecutively adding control variables. Since data on doctors and primary care coverage is only available from 2010 onwards, the last model is estimated on a restricted sample. I find that in all specifications cloud coverage is negatively correlated with forest cover. A 10 percentage point increase in cloud coverage is associated with an increase in annual upstream deforestation of between .03 and .05 percentage points or about 0.1 standard deviations. All coefficients are statistically significant at all conventional levels. 

There is however a caveat: Below, I report first stage F-statistics. It turns out that all specifications except when including only climate controls result in statistics below the @stockTestingWeakInstruments2005 threshold of 10. The variable inflation factor (VIF) of all variables is below 2, suggesting that multicollinearity is not the driving factor behind this observation. I do however find that the control variables explain a significant portion of variance in deforestation. The partial R-squared of the instrument when including the controls is only 19.75% of that when not including them.^[I regress deforestation on only the controls and obtain residuals. Then, I regress these residuals on the instrument and obtain the R-squared statistic of this model. This statistic is then compared to the R-squared value of first stage specification A.] 

For my further analyis this has the following implications: Municiaplity-specific weather seems to explain a significant portion of variance in upstream deforestation better than the instrument itself. Therefore, I cannot confidently state that my instrument is strong. This finding is not inconsistent with @assuncaoDETERingDeforestationAmazon2023, as they instrumented not the deforestation itself but rather the government intervention activity against deforestation. In other words, they instrument not the outcome but the mechanism behind the outcome. The data generation process between intervention and deforestation adds additional noise. Therefore, cloud cover is a weaker instrument in my model compared to theirs. In contrast to @assuncaoDETERingDeforestationAmazon2023 I do however have a stronger claim on exogeneity as I observe the impact of weighted upstream deforestation. It is likely that the direct impact and accidental correlation between deforestation and cloud cover decreases over distance. Cloud climate at a distance 100km from a given municipality is unlikely to impact health outcomes through weather and its correlation with the local weather is likely smaller. Nevertheless do I not claim causality for any relationships found in this section.

{{< include /tables/reg_forest_DETER_first_stage.tex >}}

In @tbl-reg-deter-mortality-tot, I show regression results of the estimated impact of upstream deforestation on overall mortality rates. In the first columns, I present OLS results when including climate controls. In the further 4 columns I show IV regression results with an increasingly large set of control variables. The coefficient of the OLS model and when including all controls are negative, while all other specifications yield positive coefficients. However, all point estimates are statistically insignificant. There appears to be no relationship between forest cover and mortality rates. 

{{< include /tables/reg_forest_DETER_mortality_tot.tex >}}

@tbl-reg-deter-mortality-l1 follows the same structure but focuses on infant mortality rate. I have to exclude several municipalities where a calculation of an infant mortality rate was impossible given years with no recorded births. The results indicate a large negative effect of deforestation on infant mortality across all specifications. When including climate controls, a decrease in instrumented forest cover by 1 percentage point is associated with an increase in infant mortality of 37 deaths per 1,000 births, a strikingly high number. However, due to high variation, not one of the coefficients is significantly different from zero. Therefore, the evidence on effects on infant mortality is again not robust enough to draw definitive conclusions.

{{< include /tables/reg_forest_DETER_mortality_l1.tex >}}

@tbl-reg-deter-hosp-rate presents the IV regression results examining the impact of upstream deforestation on hospitalization rates. The OLS specification indicates a negative but statistically insignificant coefficient for deforestation. However, when using the instrumented deforestation variable ($\widehat{\text{Deforestation}}$) across specifications A, B, and C, the coefficients become negative and gain statistical significance. Specifically, deforestation of 1 percentage point leads to an increase of approximately 0.007 to 0.0075 hospitalizations per inhabitant c.p., depending on the set of control variables. The coefficients are statistically significant at the 5% level. Economically, these results are also significant. A 1 p.p. decrease in forest cover is associated with an increase in hospitalizations of 0.24 to 0.27 standard deviations (see @tbl-reg-deter-hosp-rate-sd for the regression table with standardized outcomes). 

{{< include /tables/reg_forest_DETER_hosp_rate.tex >}}

@tbl-reg-deter-hosp-rate however also already reveals that these results are sensitive to the model parameters chosen. Results are insignificant when estimating the model using OLS and when using the reduced sample of years in which full controls are avaiable. While the latter may be explained by the weakness of the instrument in this setting, I  For this reason I re-estimate model B on spatial and temporal subsets of the data and present results in @tbl-reg-deter-hosp-rate-subsets. It turns out that my results are driven by the north- and northeast regions of Brazil. Also, in early and late periods, coefficient signs are the opposite of the aggregate results. Please also note that the instrument is relevant only the Central-West and after 2008 according to the first stage F-statistics presented. 

A potential reason for the difference in the effect across space is that polluted river water may be used differently in the remote areas of the Brazilian north. For example, better water treatment may decrease the impact of polluted rivers in the central-west region. I am not able to model this relationship void precise data on water treatment. This argument may also explain the variation across time. The estimate for the years 2005 to 2008 is likely biased due to the weak instrument in that period. Later, improvements in usage of river water may explain the increasing coefficient. They do however not explain the IV result that increased forest cover is associated with increased hospitalizations after 2012. All in all, the sensitivity analysis confirms that the aggregate results are not robust across time and space.

{{< include /tables/reg_deforestation_DETER_hosp_rate_subsets.tex >}}

In @tbl-reg-deter-ex-pop I present regression results examining the impact of upstream deforestation on medical expenditure per inhabitant. The OLS specification yields a negative but statistically insignificant coefficient for forest cover, indicating no evident relationship when using ordinary least squares regression. When regressing on the instrumented deforestation variable ($\widehat{\text{Deforestation}}$) in specifications A to C, the point estimate is positive. 

In specification A, which does not include additional controls, a 1 percentage point increase in deforestation is associated with a decrease in medical expenditure per inhabitant by approximately Brazilian Real R$10.27, significant at the 10% level. Specification B, which includes climate controls, shows a larger decrease of about R$13.67, though this coefficient is not statistically significant. Specification C, incorporating the full set of controls (GDP per capita, educational scores, a vaccination index for waterborne diseases, number of doctors per 1,000 inhabitants, and primary health care coverage), indicates a decrease in medical expenditure by approximately R$17.75, significant at the 5% level. These findings suggest that upstream deforestation is associated with lower medical expenditures per inhabitant, which might reflect either reduced health care access or reporting in deforested areas or shifts in population and health care utilization patterns. This is consistent with the hospitalization findings, further underscoring the complex and possibly counterintuitive health and economic impacts of deforestation.

{{< include /tables/reg_forest_DETER_ex_pop.tex >}}

### Extensions

A potential important confounder is migration. If the demographic of inhabitants changes with migrants working in the deforested areas, results are biased. This is especially true if the spoils of deforestation attract people from areas with superior public health. To test the hypothesis that coincidental varation in demographics from migration is biasing my results I obtain detailed data on migration. There does, to the best of my knowledge, however not exist annual data on migration between municipalities. Therefore I resort to using census microdata available in the waves of 2000 and 2010 to proxy migration. Respondees are asked whether they were born in the municipality they currently live in. The race of the respondent is also reported. Using this data, I regress the health outcomes on instrumented forest cover, the share of the population from outside the municipality and the share of the population classified as *white*. Because DETER was not active in 2000, I have no valid instrument and only report OLS estimates. Since the time span of this analysis differs from all my main specifications, results are not directly comparable. The findings below may merely serve as an indicator for the importance of migration in the surveyed relationships. 

In @tbl-reg-migration I report the results of this analysis. I find that when including migration in the set of independent variables, point estimates for the correlation between forest cover and health outcomes and similar to those obtained using OLS above. In municipalities where the share of population born outside a given municipality is higher, total mortality, hospitalization rates and medical expenditure per inhabitant are on average higher. The finings for total mortality and hospitalization are statistically significant at the 10% and 5% level, respectively. The percentage of white inhabitants is not correlated with health outcomes in a clear fashion. Standard errors for all coefficients on infant mortality are high. Overall, this analysis shows the importance of migration in the model. All OLS results above are biased if variation in migration coincides with variation in deforestation.

{{< include /tables/reg_migration.tex >}}

Because my data is structured geographically, it is likely that spatial units are not statistically independent. If neighboring municipalities are subject to the same shocks, spatial autocorrelation may bias the results. Two main model specificiations exist. The spatial autoregressive model includes spatial lags of the independent variables, modeling dependencies in the observables. The spatial error model (SEM) does so for the unobservables. I test for spatial lag- and error dependence using @millo2012splm robust tests. These test impose the presence of one dependence and then test for the presence of the other. Test statistics are reported in @tbl-spatial-tests. The $H_1$ of the tests is spatial lag (RLML) or -error (RLME) dependece, respectively. While I fail to reject the presence of neither dependency, test statistics for the spatial error dependence are on average higher. Therefore, I choose the spatial error model for my analysis.

{{< include /tables/spatial_tests.tex >}}

In @tbl-reg-spatial I report results of the SEM regression. In the first three columns I show OLS results. The remaining columns present IV results where I regress on fitted values from a first stage analogous to the IV approach. All spatial $\rho$, the parameters for the degree of spatial autocorrelation in the error term, are positive and statistically significant. Like before, coefficients for the uninstrumented forest cover are all statistically insignificant. The IV spatial regression result for the total mortality rate results in a statistically significant positive coefficient that is however small in size and economically neglibile. My IV finding on the hospitalization rate is however confirmed: A 1 p.p. decrease in forest cover is associated with an increase in hospitalizations of .067 per inhabitant c.p.. This finding is statistically significant at all conventional levels. While this serves as additional evidence towards the validity of my previous findings, this does not alleviate concerns regarding the sensitivity issues discussed above. For the expenditure per inhabitant I get a negative but insignificant result. 

{{< include /tables/reg_spatial.tex >}}

# Conclusions

The rainforests of the Amazon are under significant threat due to deforestation, with alarming global consequences. While deforestation presents short-term economic benefits, it also brings with it considerable social costs, most notably through its contribution to climate change. 

In this thesis I seek to find evidence for a potential connection between deforestation and local health outcomes due to river pollution. The underlying hypothesis is that deforestation results in soil erosion, leading to river pollution, and subsequently causing adverse health effects in areas far removed from the deforested region. Although there exists some literature on the direct health impacts of deforestation and the costs of soil erosion, the indirect, long-range health impacts via river pollution are relatively under-researched. 

Based on a large, novel dataset I attempt to find impacts of deforestation on measures of river pollution and public health indicators. The results of my empirical analysis are mostly inconclusive. pH levels of and total residue in river water seem to be positively correlated with deforestation. When forests are replaced by pasture, turbidity  

# References {.unnumbered}

:::{#refs}
:::

\setcounter{section}{0}
\renewcommand{\thesection}{\Alph{section}}

\setcounter{table}{0}
\renewcommand{\thetable}{A\arabic{table}}

\setcounter{figure}{0}
\renewcommand{\thefigure}{A\arabic{figure}}

# Appendix {.appendix}

## Hydrological Model {#sec-appendix-hydro}

The central idea of my research is that deforestation along rivers leads to pollution. In order to model this relationship one needs to identify deforestation and model at what river any contamination may take place. If there is indeed soil erosion after deforestation, water washes harmful substances from the bare earth towards the closest stream. In doing that it follows roughly the path of highest gradient downhill. I therefore attempt to compute a relationship between each point on the map and the river any water at that point will reach. To simplify this large problem I start the other way around. First I establish a model of all Brazilian rivers based on official data. Then, I separate the rivers into segments of 1km or less. For each segment I then compute the exact area from which all water will flow into the given river segment. I end up with a spatial dataset that relates polygons with river segments and may be used for exact extraction and attribution of deforestation with rivers.

To begin with, I start analyzing @agencianacionaldeaguasesaneamentobasicoanaSistemaNacionalInformacoes2017, the official spatial database of rivers in Brazil. The data are structured into a network model. In this network, rivers are edges and there are a range of node types with unique functions in the hydrological system. 

- Estuary nodes (roots) are the points where rivers lead into the sea. Starting from any node in the network, there can always only be one reachable estuary for it to be well defined. There are 1,025 estuary and therefore river sub-systems in the data
- Source nodes (leaves) are the points where rivers originate
- Confluence nodes are the points where two rivers merge
- Border nodes are required in order for edges in the network to be bijectively relatable to administrative regions

I segmentize rivers to a distance of 1km or less and further split lines where they cross a administrative boundary. Starting from the estuary, I calculate each segments distance to the sea. The segmentization cuts the river at each full kilometer mark in distance to the estuary. Border and confluence cuts are at distances to the sea that do not divide by 1km without rest. Each segment is given a unique ID consisting of four values: The estuary, the river, the segment and the subsegment. There is provided a name for many rivers in the dataset. Consecutive rivers with the same name share one river ID. If at a confluence no upstream river shares the name of the downsstream section, new river IDs are given. The segment counter starts at 0 at each river's most downstream confluence and is increased at confluence and border nodes. Finally, the subsegment ID is generated from segmentizing to a maximum length of 1km. This numbering is achieved using a recursive script that parses the disjunct estuary systems starting from the estuary node. 

The analyis results into two distinct databases: One containing all river shapes, IDs, names if available, distance to the estuary and IDs for upstream and downstream nodes. A second database defines node points with ids and type. In @fig-river-network-model I present an example of detail of my analysis. From this data I derive a reachability database using a direction graph representation and depth-first search (DFS). I identify all nodes reachable from a specified start node. Aggregating by municipality, I obtain all upstream rivers reachable from any river in the municipality and the corresponding shortest distance. This is then used to calculate spatial weighting matrices for the central regression model of my analysis. I aggregate deforestation by municipality as a weighted mean of deforestation in upstream municialities. Weights are decreasing exponentially in distance up to a threshold of 1000 kilometers. An example of this weighting for two municipalities is given in @fig-weights-example.

![Example of River Network Model](/figures/river_system_example.png){#fig-river-network-model}

![Example of Upstream Weighting](/figures/weights_example.png){#fig-weights-example height=40%}

This river model in hand I then proceed to compute the drainage areas in which I measure deforestation. My approach is to use a height profile of Brazil [@europeanspaceagencyCopernicus2022] and compute drainage areas for every river segment. This is achieved with the alogoritm of @bartos_2020. I use the software to calculate drainage areas for the upstream and downstream nodes of every river edge and the difference the upstream from the downstream polygon. There were however major inconsistencies between the river and elevation data. In @fig-drainage-preprocessing-f you can observe that river lines are not always found at the exact position of a corresponding trench. This requires an algorithm to relate river nodes with elevation trench edges. 

To overcome this central issue I followed a multi-facted approach: Firstly, I use drainage polygon data provided by the Brazilian National Water Agency to bound the maximum possible drainage area around the rivers. The data deleniate drainage polygons between all major confluences. Therefore these polygons alone do not allow for an exact determination of drainage for my river segments. Further, some smaller rivers are ignored and their drainage is included in the area of the larger downstream river. Still, I found general alignment with my river model to be good and chose to perform extensive preprocessing of these shapes to allow their usage as bounds for my further steps. See @fig-drainage-preprocessing-ab for an example of the data and preprocessing results.  

::: {#fig-drainage-preprocessing-ab layout="[0.4, -.1, 0.4]" layout-valign="top"}

![Rivers (blue) and bounding ANA drainage polygons (orange)](/figures/drainage_preprocessing_example_a.png){#fig-drainage-preprocessing-a}

![Result of Preprocessing](/figures/drainage_preprocessing_example_b.png){#fig-drainage-preprocessing-b}

Examples for ANA drainage polygon preprocessing. In @fig-drainage-preprocessing-a some smaller rivers are ignored and do not feature a detailed drainage polygon. This would yield imprecise outcomes in further processing steps. In @fig-drainage-preprocessing-b I show results from preprocessing and combination. In the dotted box preprocessing was succesful. In the box with the dashed exterior I was not able to establish more detail.

:::

The preprocessing algorithm works as follows: I identify polygons in which there are multiple river edges longer than a threshold of 200m. There may be multiple such edges within the polygon. Then I identify the confluences between those rivers that need to be fixed (@fig-drainage-preprocessing-c). In addition to that I compute a drainage profile for the polgyon, modeling the flow of water between the cells (@fig-drainage-preprocessing-d). I then extract the network of trenches defined by the drainage profile (@fig-drainage-preprocessing-e). 

::: {#fig-drainage-preprocessing-cde layout="[0.3, -0.05, 0.3, -0.05, 0.3]" layout-valign="top"}

![River confluences where detail is missing. I attempt to fix these](/figures/drainage_preprocessing_example_c.png){#fig-drainage-preprocessing-c}

![An example of a drainage profile](/figures/drainage_preprocessing_example_d.png){#fig-drainage-preprocessing-d}

![Extracted trench network from drainage profile](/figures/drainage_preprocessing_example_e.png){#fig-drainage-preprocessing-e}

Examples for ANA drainage polygon preprocessing (contd.)
:::

At this point I have two sets of rivers: One from the official river data, and one from my own calculations off the height profile (@fig-drainage-preprocessing-f). I identify all confluences in the height profile river network (@fig-drainage-preprocessing-g). In the next step I find the best possible match between the confluence in need of fixing and a height-based confluence based on a custom metric: Moving in the upstream direction at the height-confluence along the two feeding rivers by one unit, I compute all upstream area that drains into the two result points (@fig-drainage-preprocessing-h). Taking the original shapes of the rivers to fix I then calculate the distance each of the two rivers in the two upstream drainage areas. I choose the height-confluence that seperates the two rivers best based on their length within the polygons, limiting my selection to those that contain at least 50% of the river length. If no height-confluence can be found in this fashion, I do not fix the polygon. 

::: {#fig-drainage-preprocessing-fge layout="[0.3, -0.05, 0.3, -0.05, 0.3]" layout-valign="top"}

![Two river networks: The official shapes (orange) and the one derived from the height profile (blue) *Note:* Both only match approximately](/figures/drainage_preprocessing_example_f.png){#fig-drainage-preprocessing-f}

![Confluence nodes in two river networks: Official (circles) and derived (diamonds)](/figures/drainage_preprocessing_example_g.png){#fig-drainage-preprocessing-g}

![Confluence node with the highest separation score (yellow) and the corresponding downstream polygons. This node is chosen for subsplitting](/figures/drainage_preprocessing_example_h.png){#fig-drainage-preprocessing-h}

Examples for ANA drainage polygon preprocessing (contd.)
:::

The polygon is then altered by differencing out the smaller rivers' polygons from the original polygon. This is done using a DFS algorithm that subtracts the union of all upstream nodes from each node (@fig-drainage-preprocessing-i). Drainage polygons are then assigned to the river with the longest overlap. The preprocessed polygons are finally unioned by associated (estuary and) river ID. This allows for maximum detail of my further processing. For an example of the result of the process see @fig-drainage-preprocessing-b.

![Result of subsplitting: Main polygon and new polygon for smaller downstream river](/figures/drainage_preprocessing_example_i.png){#fig-drainage-preprocessing-i height=20%}

Using these preprocessed ANA drainage limits I then extract detailed drainage polygons around the rivers. To achieve this I compute the drainage profile in the polygon and extract the trench network (like in @fig-drainage-preprocessing-e above). Then I segmentize the river line into pieces of one kilometer length or less. Between each pair of subsequent segments lies a node. For every node I find the nearest point on the trench network. For this point I calculate the total upstream drainage area. To force this area into my limits I union the most upstream node in the limits with the current limits and then recursively subtract the limits from all subsequent drainage areas. The result of this algorithm is most detailed drainage areas I can compute (see @fig-drainage-extraction for an example).

![Extracted, detailed drainage polygons. *Note:* Some areas were not able to be related to any river and sometimes incomplete river matching resulting in large polygons](/figures/drainage_extraction_example.png){#fig-drainage-extraction height=40%}

Finally I use these polygons and extract deforestation from the @souzaReconstructingThreeDecades2020 data. Because this task is very resource intensive I follow a Producer-Consumer software engineering model. The producer process loads data in grid cells and places it into a queue, while multiple consumer processes retrieve data from the queue and perform the extraction and processing tasks. This model ensures that data loading (a potentially slow I/O operation) and data processing (a CPU-intensive operation) can proceed concurrently, optimizing resource utilization and improving overall throughput. To manage resources effectively, the script employs semaphores to control the number of datasets loaded into memory concurrently. This prevents memory overload by ensuring that only a limited number of datasets are processed at any given time. By coordinating access to shared resources and controlling the flow of data through the pipeline, I maintain efficient memory usage and prevent bottlenecks.

{{< include /tables/mapbiomas_equivalence.tex >}}

Most of the described processes are multiprocessing enabled and were executed on the BwUniCluster2.0. On a 8-core machine with 96GB of RAM all scripts take about twelve hours to run concurrently.

![Data Processing Workflow Chart](/figures/data_workflow.png){#fig-data-workflow width=90%}

![Temporal availability of analysis variables](/figures/variable_temporal_ranges.png){#fig-variable-temporal-ranges height=40%}

![Water Quality Measurement Stations](/figures/stations_time_spatial.png){#fig-stations height=60%}

::: {#fig-balanced-panels layout-ncol=2}

![Large panel for extended controls between 2005-2017](/figures/large_panel_map.png){#fig-balanced-large-panel}

![Small panel for full controls and hospitalization data between 2010-2017](/figures/small_panel_map.png){#fig-balanced-small-pane}

Municipalities included in panels. *Note*: Because of missing values in the different variables, I have to exclude several municipalities to achieve a balanced panel. The resulting compositions are noted down here.
:::

\newpage

{{< include /tables/reg_stations_deforestation_sd.tex >}}

{{< include /tables/reg_stations_deforestation_replacement_levels.tex >}}

{{< include /tables/reg_stations_deforestation_distance.tex >}}

{{< include /tables/reg_forest_DETER_hosp_rate_sd.tex >}}

{{< include /documents/thesis_paper/statutory_declaration.tex >}}